<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard - Complaints & Feedback</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --primary: #1f1f2e;
  --accent: #4e73df;
  --card-bg: #2c2c3d;
  --text-light: #f4f4f4;
  --text-dark: #ccc;
  --success: #28a745;
  --pending: #ffc107;
  --inprogress: #17a2b8;
  --resolved: #6c757d;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Roboto',sans-serif;}
body{background-color: var(--primary); color: var(--text-light);}
header{background-color: var(--accent); padding:20px; text-align:center; font-size:1.5rem; font-weight:700; color:white;}
.container{padding:20px; max-width: 1200px; margin:auto;}

/* Stats Cards */
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; margin-bottom:40px;}
.card{background-color:var(--card-bg); padding:20px; border-radius:10px; text-align:center; transition: transform 0.3s, box-shadow 0.3s;}
.card:hover{transform: translateY(-5px); box-shadow:0 10px 20px rgba(0,0,0,0.3);}
.card h3{font-size:1.2rem;margin-bottom:10px;color:var(--text-dark);}
.card p{font-size:2rem;font-weight:700;}

/* Charts */
.charts{display:grid;grid-template-columns:1fr 1fr; gap:40px; margin-bottom:40px;}
canvas{background-color: var(--card-bg); border-radius:10px; padding:20px;}
@media(max-width:900px){.charts{grid-template-columns:1fr;}}

/* Tables */
section{margin-bottom:50px;}
h2{margin-bottom:20px; text-align:center;}
table{width:100%; border-collapse:collapse; background-color:var(--card-bg); border-radius:10px; overflow:hidden;}
th, td{padding:12px; text-align:left; color:var(--text-light);}
th{background-color:var(--accent);}
tr:nth-child(even){background-color:#34344f;}
tr:hover{background-color:#40405f;}
button, select{padding:5px 10px; border-radius:5px; border:none; margin-right:5px; cursor:pointer;}
select{background-color:#444466;color:white;}
button{background-color:var(--accent); color:white; transition:0.3s;}
button:hover{background-color:#3b52b5;}
.delete-btn{background-color:#e74a3b;}
</style>
</head>
<body>

<header>Admin Dashboard</header>
<div class="container">

  <!-- Stats Cards -->
  <div class="stats">
    <div class="card">
      <h3>Total Complaints</h3>
      <p id="totalComplaints">0</p>
    </div>
    <div class="card">
      <h3>Pending</h3>
      <p id="pendingComplaints">0</p>
    </div>
    <div class="card">
      <h3>In Progress</h3>
      <p id="inProgressComplaints">0</p>
    </div>
    <div class="card">
      <h3>Resolved</h3>
      <p id="resolvedComplaints">0</p>
    </div>
  </div>

  <!-- Charts -->
  <div class="charts">
    <canvas id="typeChart"></canvas>
    <canvas id="statusChart"></canvas>
  </div>

  <!-- Complaints Table -->
  <section>
    <h2>Complaints Received</h2>
    <table id="complaintsTable">
      <thead>
        <tr>
          <th>Name</th><th>Roll.No</th><th>Room</th><th>Type</th><th>Description</th><th>Date</th><th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Feedback Table -->
  <section>
    <h2>Feedback Received</h2>
    <table id="feedbackTable">
      <thead>
        <tr>
          <th>Name</th><th>Roll.No</th><th>Feedback</th><th>Date</th><th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Solved Complaints Table -->
  <section>
    <h2>Complaints Solved</h2>
    <table id="solvedTable">
      <thead>
        <tr>
          <th>Name</th><th>Roll.No</th><th>Room</th><th>Type</th><th>Description</th><th>Date</th><th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

</div>

<script>
let complaints = JSON.parse(localStorage.getItem("complaints"))||[];
let feedback = JSON.parse(localStorage.getItem("feedback"))||[];
let solvedComplaints = JSON.parse(localStorage.getItem("solvedComplaints"))||[];

const complaintsTbody = document.querySelector("#complaintsTable tbody");
const feedbackTbody = document.querySelector("#feedbackTable tbody");
const solvedTbody = document.querySelector("#solvedTable tbody");

// Render Functions
function renderComplaints(){
  complaintsTbody.innerHTML="";
  if(complaints.length===0){
    const row=complaintsTbody.insertRow();
    const cell=row.insertCell(); cell.colSpan=7; cell.textContent="No complaints found."; cell.style.textAlign="center";
  } else {
    complaints.forEach((c,i)=>{
      const row=complaintsTbody.insertRow();
      row.insertCell().textContent=c.name;
      row.insertCell().textContent=c.roll;
      row.insertCell().textContent=c.room;
      row.insertCell().textContent=c.type;
      row.insertCell().textContent=c.desc;
      row.insertCell().textContent=c.date;

      const actionCell=row.insertCell();
      const deleteBtn=document.createElement("button"); deleteBtn.textContent="Delete with Photo"; deleteBtn.className="delete-btn";
      const fileInput=document.createElement("input"); fileInput.type="file"; fileInput.accept="image/*"; fileInput.style.display="none";

      deleteBtn.onclick=()=>{fileInput.style.display="block";}
      fileInput.onchange=()=>{
        const file=fileInput.files[0];
        if(file && file.type.startsWith("image/")){
          if(confirm("Delete this complaint?")){
            solvedComplaints.push(c); complaints.splice(i,1);
            localStorage.setItem("solvedComplaints",JSON.stringify(solvedComplaints));
            localStorage.setItem("complaints",JSON.stringify(complaints));
            renderAll(); alert("Moved to Solved Complaints");
          }
        } else {alert("Upload valid image.");}
      }
      actionCell.appendChild(deleteBtn); actionCell.appendChild(fileInput);
    });
  }
}

function renderFeedback(){
  feedbackTbody.innerHTML="";
  if(feedback.length===0){
    const row=feedbackTbody.insertRow(); const cell=row.insertCell();
    cell.colSpan=5; cell.textContent="No feedback available."; cell.style.textAlign="center";
  } else {
    feedback.forEach((f,i)=>{
      const row=feedbackTbody.insertRow();
      row.insertCell().textContent=f.name;
      row.insertCell().textContent=f.roll;
      row.insertCell().textContent=f.message;
      row.insertCell().textContent=f.date;
      const actionCell=row.insertCell();
      const deleteBtn=document.createElement("button"); deleteBtn.textContent="Delete"; deleteBtn.className="delete-btn";
      deleteBtn.onclick=()=>{if(confirm("Delete this feedback?")){feedback.splice(i,1); localStorage.setItem("feedback",JSON.stringify(feedback)); renderFeedback(); alert("Deleted");}};
      actionCell.appendChild(deleteBtn);
    });
  }
}

function renderSolved(){
  solvedTbody.innerHTML="";
  if(solvedComplaints.length===0){
    const row=solvedTbody.insertRow(); const cell=row.insertCell(); cell.colSpan=7; cell.textContent="No solved complaints."; cell.style.textAlign="center";
  } else {
    solvedComplaints.forEach((c,i)=>{
      const row=solvedTbody.insertRow();
      row.insertCell().textContent=c.name;
      row.insertCell().textContent=c.roll;
      row.insertCell().textContent=c.room;
      row.insertCell().textContent=c.type;
      row.insertCell().textContent=c.desc;
      row.insertCell().textContent=c.date;
      const actionCell=row.insertCell();
      const deleteBtn=document.createElement("button"); deleteBtn.textContent="Delete"; deleteBtn.className="delete-btn";
      deleteBtn.onclick=()=>{if(confirm("Permanently delete?")){solvedComplaints.splice(i,1); localStorage.setItem("solvedComplaints",JSON.stringify(solvedComplaints)); renderSolved(); alert("Deleted");}};
      actionCell.appendChild(deleteBtn);
    });
  }
}

// Stats & Charts
function updateStats(){
  document.getElementById("totalComplaints").innerText=complaints.length+solvedComplaints.length;
  document.getElementById("pendingComplaints").innerText=complaints.length;
  document.getElementById("inProgressComplaints").innerText=0; // optional
  document.getElementById("resolvedComplaints").innerText=solvedComplaints.length;
}

function renderCharts(){
  const types=["Cleanliness","Water","Electricity","Food","Others"];
  const typeCount=types.map(t=>complaints.concat(solvedComplaints).filter(c=>c.type===t).length);
  const statuses=["Pending","In Progress","Resolved"];
  const statusCount=[
    complaints.length,
    0,
    solvedComplaints.length
  ];

  const ctxType=document.getElementById("typeChart").getContext("2d");
  if(window.typeChartInstance) window.typeChartInstance.destroy();
  window.typeChartInstance=new Chart(ctxType,{
    type:'bar',
    data:{labels:types,datasets:[{label:'Complaints by Type',data:typeCount,backgroundColor:['#4e73df','#1cc88a','#36b9cc','#f6c23e','#e74a3b']}]},
    options:{responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}}}
  });

  const ctxStatus=document.getElementById("statusChart").getContext("2d");
  if(window.statusChartInstance) window.statusChartInstance.destroy();
  window.statusChartInstance=new Chart(ctxStatus,{
    type:'doughnut',
    data:{labels:statuses,datasets:[{label:'Complaints by Status',data:statusCount, backgroundColor:['#ffc107','#17a2b8','#28a745']}]},
    options:{responsive:true, plugins:{legend:{position:'bottom'}}}
  });
}

function renderAll(){ renderComplaints(); renderFeedback(); renderSolved(); updateStats(); renderCharts();}
renderAll();
</script>

</body>
</html>
